<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Three Geo A-Frame</title>
	<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/w3reality/three-geo/master/dist/three-geo.min.js"></script>
	
	<script>
		
		AFRAME.registerComponent('map', {
      schema: {
       token: {type: 'string', default: '*******'},
        lat: {type: 'number', default: 35.3778},
        lng: {type: 'number', default: 138.7472},
        radius: {type: 'number', default: 5.0},
        zoom: {type: 'number', default: 13},
        axes_on: {type: 'boolean', default: true},
    },

	  init: function () {
	
		    // scene = document.querySelector('#test-map').object3D;
        geoScene = this.el.object3D;

        if (this.data.axes_on){
          const walls = new THREE.LineSegments(
              new THREE.EdgesGeometry(new THREE.BoxBufferGeometry(1, 1, 1)),
              new THREE.LineBasicMaterial({color: 0xcccccc}));
          walls.position.set(0, 0, 0);
          geoScene.add(walls);
          geoScene.add(new THREE.AxesHelper(1));
        }

        const tgeo = new ThreeGeo({
            tokenMapbox: this.data.token, // <---- set your Mapbox API token here
        });

        if (tgeo.tokenMapbox === '********') {
            alert('Please provide your Mapbox API token with the ThreeGeo constructor.');
        } else {
            // params: [lat, lng], terrain's radius (km), zoom resolution, callbacks
            // Beware the value of radius; radius > 5.0 (km) could trigger huge number of tile API calls!!
            tgeo.getTerrain([this.data.lat, this.data.lng], this.data.radius, this.data.zoom, {
                onRgbDem: (meshes) => { // your implementation when terrain's geometry is obtained'
					console.log('obtained meshes...');
					console.log('meshes: ', meshes);
                    meshes.forEach((mesh) => { geoScene.add(mesh); });
                },
                onSatelliteMat: (mesh) => { // your implementation when terrain's satellite texture is obtained
                },
            });
        }
		
    }
    });
  </script>
	
</head>
<body>
 
	<a-scene background="color: black">
    <a-entity id="first" map="token: pk.eyJ1Ijoia2FkZW5qcyIsImEiOiJjamxtcWF3NDIxYXZkM3dzMTZhYnE1dHNwIn0.cssVH1pM4KEQi345xdG8AQ;
                   lat: 46.5763;
                   lng: 7.9904;
                   radius: 10;
                   zoom: 13;
                   axes_on: false;
                   "
              rotation="-90 0 0" position="0 0.5 -3" scale="2 2 2"></a-entity>
    
	</a-scene>
	
</body>
</html>
