<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Three Geo A-Frame</title>
	<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/w3reality/three-geo/master/dist/three-geo.min.js"></script>
  
  <!-- Camera resize -->    
  <script src="https://rawgit.com/fernandojsg/aframe-camera-transform-controls-component/master/dist/aframe-camera-transform-controls-component.js"></script>
  
  <!-- Environment -->
  <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
	
	<script>
		
		AFRAME.registerComponent('map', {
      schema: {
       token: {type: 'string', default: '*******'},
        lat: {type: 'number', default: 35.3778},
        lng: {type: 'number', default: 138.7472},
        radius: {type: 'number', default: 5.0},
        zoom: {type: 'number', default: 13},
        axes_on: {type: 'boolean', default: true},
    },

	  init: function () {
	
        geoScene = this.el.object3D;

        if (this.data.axes_on){
          const walls = new THREE.LineSegments(
              new THREE.EdgesGeometry(new THREE.BoxBufferGeometry(1, 1, 1)),
              new THREE.LineBasicMaterial({color: 0xcccccc}));
          walls.position.set(0, 0, 0);
          geoScene.add(walls);
          geoScene.add(new THREE.AxesHelper(1));
        }

        const tgeo = new ThreeGeo({
            tokenMapbox: this.data.token, // <---- set your Mapbox API token here
        });

        if (tgeo.tokenMapbox === '********') {
            alert('Please provide your Mapbox API token with the ThreeGeo constructor.');
        } else {
            // params: [lat, lng], terrain's radius (km), zoom resolution, callbacks
            // Beware the value of radius; radius > 5.0 (km) could trigger huge number of tile API calls!!
            tgeo.getTerrain([this.data.lat, this.data.lng], this.data.radius, this.data.zoom, {
                onRgbDem: (meshes) => { // your implementation when terrain's geometry is obtained'
					console.log('obtained meshes...');
					console.log('meshes: ', meshes);
                    meshes.forEach((mesh) => { geoScene.add(mesh); });
                },
                onSatelliteMat: (mesh) => { // your implementation when terrain's satellite texture is obtained
                },
            });
        }
		
    }
    });
  </script>
	
</head>
<body>
 
	<a-scene camera-transform-controls="">
    
    <a-entity environment="preset: checkerboard"></a-entity>
    
    <a-entity id="cameraRig">
		    <a-camera position="0 1.4 0"></a-camera>
        <a-entity id="lefthand" camera-transform-controls-hand="hand:left" vive-controls="hand: left" oculus-touch-controls="hand: left" windows-motion-controls="hand: left"></a-entity>
        <a-entity id="righthand" camera-transform-controls-hand="hand:right" vive-controls="hand: right" oculus-touch-controls="hand: right" windows-motion-controls="hand: right"></a-entity>
    </a-entity>
    
    <a-entity id="first" map="token: pk.eyJ1Ijoia2FkZW5qcyIsImEiOiJjamxtcWF3NDIxYXZkM3dzMTZhYnE1dHNwIn0.cssVH1pM4KEQi345xdG8AQ;
                   lat: 46.5763;
                   lng: 7.9904;
                   radius: 10;
                   zoom: 13;
                   axes_on: false;
                   "
              rotation="-90 180 0" position="0 0.7 -1.5" scale="1 1 1"></a-entity>
    
	</a-scene>
	
</body>
</html>
